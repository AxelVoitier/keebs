# ビルドガイド（共通部分）

## Pro Microのもげ防止加工（推奨）
https://qiita.com/hdbx/items/2f3e4ddfcadda2a5578e
を参考に、エポキシ接着剤で、もげ防止加工を施します。

## ファームウェアの書き込み
[Getting Started - QMK Firmware](https://docs.qmk.fm/#/newbs_getting_started)を参照して頂き、ファームウェアを書き込む環境を用意します。
Petit Splitのファームは本家にマージされていないので、`https://github.com/foostan/qmk_firmware/tree/petit_split` をクローンして使ってください。

環境ができましたら、下記コマンドで Petit Split 用にファームウェアをビルドします。

```
make petit_split:default
```

ビルドが完了したら下記コマンドを実行します。

```
make petit_split:default:avrdude
```

実行すると下記のようなログがでて、`.` が増えていくことが確認出来ると思います。
この間にリセットスイッチを __2回__ 押すとファームウェアの書き込みが完了します。

```
<省略>

Checking file size of petit_split_rev1_default.hex                                                        [OK]
 * File size is fine - 27328/28672
Copying crkbd_rev1_default.hex to qmk_firmware folder                                               [OK]
Detecting USB port, reset your controller now........
```

片側のProMicroにファームウェアの書き込みが完了したら、もう片方も同じ手順で書き込みを行います。

## 基板の表裏
キースイッチを配置する枠が描いてあるほうが表で、Kailh PCBソケットを配置する枠が描いてあるほうが裏です。

## ダイオードの取り付け
キースイッチ付近にダイオードを配置します。

基板の表と裏、どちら側に付けても構いません。

ダイオードの黒くなっている側が、基板の線が引いてある側になるように配置します。

はじめに1つだけダイオードを曲げて穴に差し込んでみて、うまくいく曲げ具合を見つけて残りのダイオードを同じように曲げておくとやりやすいです。

ダイオードを配置した後、マスキングテープで浮かないようにカバーしておきます。

基板を裏返して全てハンダ付けします。

ハンダから飛び出ている線を切ります。

## PCBソケットの取り付け
基板の裏の枠に合うようにPCBソケットを配置します。

CherryMX用のPCBソケットを置く場合は、向きがあるので注意してください。

PCBソケット両端の金属部分をハンダ付けします。

## TRRSコネクタの取り付け
基板の表の枠に合うようにTRRSコネクタを配置します。

裏返して金属部分をハンダ付けします。

### タクトスイッチの取り付け
基板の表の枠に合うようにタクトスイッチを配置します。

裏返して金属部分をハンダ付けします。

### Pro Microの取り付け
基板の表のPro Micro設置部分の2箇所に、Pro Microに付属している12ピンのピンヘッダの短いほうを差し込みます。

スルーホールがジグザグになっているので、少し入れにくくなっています。ケガしないように注意しながらやってください。

ピンヘッダにPro Microを差し込むことができるか確かめます。大丈夫ならPro Microを外します。

基板を裏返して、PCBソケットの高さより低くなるようにピンヘッダのピンを切ります。

基板とピンヘッダはジグザグのスルーホールで接触しているため、ハンダ付けしません。

基板を表に戻し、ピンヘッダにPro Microを差し込みます。Pro Microの裏面（平らなほう）が上になるようにします。

Pro Microとピンヘッダをハンダ付けします。

ハンダから飛び出ている線を切ります。

### スタビライザーの取り付け
スタビライザーを付ける場合に表側に付けます。

### キースイッチの取り付け
表側から差し込みます。

### キーキャップの取り付け
キースイッチにキーキャップをはめます。

### ゴム足の取り付け
ゴム足を裏面に取り付けます。試打して基板のたわみが気になればゴム足を増やします。
