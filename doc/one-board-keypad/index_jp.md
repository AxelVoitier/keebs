# One Board Keypad

## 必要なパーツ
<!--- Bill Of Materials -->
| 名前 | 数 | 備考 | 
|:-|:-|:-|
| SU120 PCB | 1枚 | [入手方法](../common/pcb_order_guide.md) |
| Pro Micro | 1個 | スルーホールをZigzag仕様にしてあるのでコンスルーではなく普通の付属ピンヘッダを使います |
| 4本足のタクトスイッチ | 1個 | |
| ダイオード 1N4148 | 19個 | 表面実装タイプも可 |
| LEDテープ | お好みの長さ | WS2812Bを使用したもの |
| Kailh PCBソケット CherryMX用 または Choc用 | 19個 | あとで違うスイッチを試せるように両方付けておくこともできます|
| 5ピン仕様のキースイッチ CherryMX用 または Choc用 | 19個 | トッププレートがないので3ピン仕様だとガタガタになりやすいです |
| キーキャップ CherryMX用 または Choc用 | 19個 | 17個は1U、1個は1U～2.25U、1個は1U～2.75U |
| スタビライザー 2U用 | 2個 | PCBマウントのもの 2Uサイズ以上のキーキャップを付ける場合にお好みで |
| クッションゴム | 4個以上 | たわみが気になれば増やしてください 適当なものが見つからなければとりあえず100円ショップの滑り止めシートを敷いても |
| Micro USBケーブル | 1本 | |

## 使用する道具類

| 名前 | 備考 | 
|:-|:-|
| はんだこて | 表面実装ダイオードを使用する場合は温度が調整できるもの |
| 電子工作用ハンダ | 有鉛タイプが作業しやすい |
| はんだこて台 | |
| ニッパー | 100円ショップのものは切れ味が良くないのとツライチにならないので、もうちょっといいもの https://www.amazon.co.jp/b/?node=2039358051 |
| エポキシ接着剤 | 2液混合タイプ |
| マスキングテープ | |

## ビルドガイド

### Pro Microのもげ防止加工
https://qiita.com/hdbx/items/2f3e4ddfcadda2a5578e
を参考に、エポキシ接着剤でもげ防止加工を施してください。

### ダイオードの取り付け
19箇所にダイオードを配置します。

基板の表と裏、どちら側に付けても構いません。

ちなみに、キースイッチを配置する枠が描いてあるほうが表で、Kailh PCBソケットを配置する枠が描いてあるほうが裏です。

ダイオードの黒くなっている側が、基板の線が引いてある側になるように配置します。

はじめに1つだけダイオードを曲げて穴に差し込んでみて、うまくいく曲げ具合を見つけて残りのダイオードを同じように曲げておくとやりやすいです。

ダイオードを配置した後、マスキングテープで浮かないようにカバーしておきます。

基板を裏返して全てハンダ付けします。

ハンダから飛び出ている線を切ります。

### PCBソケットの取り付け

基板の裏の枠に合うようにPCBソケットを配置します。

CherryMX用のPCBソケットを置く場合は、向きがあるので注意してください。

PCBソケット両端の金属部分をハンダ付けします。

### TRRSコネクタの取り付け

基板の表の枠に合うようにTRRSコネクタを配置します。

裏返して金属部分をハンダ付けします。

### タクトスイッチの取り付け

基板の表の枠に合うようにタクトスイッチを配置します。

裏返して金属部分をハンダ付けします。

### Pro Microの取り付け

基板の表のPro Micro設置部分の2箇所に、Pro Microに付属している12ピンのピンヘッダの長いほうを差し込みます。

スルーホールがジグザグになっているので、少し入れにくくなっています。ケガしないように注意しながらやってください。

ピンヘッダにPro Microを差し込むことができるか確かめます。大丈夫ならPro Microを外します。

基板を裏返して、PCBソケットの高さより低くなるようにピンヘッダのピンを切ります。

基板とピンヘッダはジグザグのスルーホールで接触しているため、ハンダ付けしません。

基板を表に戻し、ピンヘッダにPro Microを差し込みます。Pro Microの裏面（平らなほう）が上になるようにします。

Pro Microとピンヘッダをハンダ付けします。

### スタビライザーの取り付け

スタビライザーを付ける場合に表側に付けます。

### キースイッチの取り付け

表側から19箇所に差し込みます。

### キーキャップの取り付け

キースイッチにキーキャップをはめます。

ゴム足を裏面に取り付けます。試打して基板のたわみが気になればゴム足を増やします。



基板にピンヘッダを刺した状態でPro Microを刺しはんだづけを

![image](https://user-images.githubusercontent.com/736191/48524659-95d81300-e8c4-11e8-9c26-033c90b91878.png)

## 実装

面付を切り離し、どちらを左手(右手)にするか決めておきます。

![image](https://user-images.githubusercontent.com/736191/48524696-b7d19580-e8c4-11e8-810c-2eaae36cae89.png)

### リセットスイッチとTRRSジャックの取り付け

まずはリセットスイッチとTRRSジャックを付けていきます。
写真の位置にはんだ付けします。

![image](https://user-images.githubusercontent.com/736191/48524753-ec455180-e8c4-11e8-8855-08e2a0d7e856.png)

### ProMicroの取り付け

次にProMicroを取り付けていきます。

ProMicroの裏側が正面に来るようにピンヘッダを取り付けます。
またこのピンヘッダがシルクの白い枠に収まるようにPCBに取り付けます。

このキーボードに限らずProMicroについてはシルクでピンの情報が書かれています(RAWやGNDなど)。
もし取り付け位置がわからない場合は、ProMicro側のシルクとPCB側のシルクが合うようにすると間違いが防げます。

![image](https://user-images.githubusercontent.com/736191/48524845-46461700-e8c5-11e8-8c19-07bafc990e12.png)

### ダイオードの取り付け

次にダイオードを取り付けていきます。

量が少ないので両手分いっきに取り付けます。
片側を反転させて、取り付けるダイオードの向きを両手分で揃えておくと間違いなくスムーズに取り付けられます。

![image](https://user-images.githubusercontent.com/736191/48524891-68d83000-e8c5-11e8-87b2-4d8e36540ab2.png)

### PCBソケットの取り付け

次にPCBソケットを取り付けていきます。
なおはんだ付けはこれで最後です。

PCBソケットのパッド部分はギリギリの大きさになっているので、先にはんだを両足分盛っておきます。
予備ハンダのイメージですが後からはんだを追加し難いので多少多めに盛っておきます。

あとはソケットを穴にはめて指で抑えながら、盛ったはんだを溶かして接着します。

![image](https://user-images.githubusercontent.com/736191/48524959-a3da6380-e8c5-11e8-8e39-68f60013d2bf.png)

### プレートの取り付け

最後にプレートを取り付けていきます。

プレートにスペーサーを取り付け、キースイッチをトッププレートにはめます(後からでもいいですが先のほうが楽)。
あとはここにかぶせるようにPCBをはめます。キースイッチが全てPCBソケットにはまっていることが確認できればOKです。

最後にボトムプレートを取り付け、ゴム足を貼れば完成です。

![image](https://user-images.githubusercontent.com/736191/48525051-fae03880-e8c5-11e8-8d8d-305140bd3608.png)

## ファームウェア
https://docs.qmk.fm/#/newbs_getting_started こちらを参照して頂き、ファームウェアを書き込む環境を用意します。
Petit Splitのファームは本家にマージされていないので、`https://github.com/foostan/qmk_firmware/tree/petit_split` をクローンして使ってください。

環境ができましたら、下記コマンドで Petit Split 用にファームウェアをビルドします。

```
make petit_split:default
```

ビルドが完了したら下記コマンドを実行します。

```
make petit_split:default:avrdude
```

実行すると下記のようなログがでて、`.` が増えていくことが確認出来ると思います。
この間にリセットスイッチを __2回__ 押すとファームウェアの書き込みが完了します。

```
<省略>

Checking file size of petit_split_rev1_default.hex                                                        [OK]
 * File size is fine - 27328/28672
Copying crkbd_rev1_default.hex to qmk_firmware folder                                               [OK]
Detecting USB port, reset your controller now........
```

片側のProMicroにファームウェアの書き込みが完了したら、もう片方も同じ手順で書き込みを行います。

以上で完成です。
